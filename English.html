// Quiz Application Logic
class QuizApp {
    constructor() {
        this.currentQuestion = 0;
        this.score = 0;
        this.wrongAnswers = 0;
        this.isAnswered = false;
        
        // DOM Elements
        this.welcomeScreen = document.getElementById('welcome-screen');
        this.quizScreen = document.getElementById('quiz-screen');
        this.resultsScreen = document.getElementById('results-screen');
        
        this.startBtn = document.getElementById('start-btn');
        this.nextBtn = document.getElementById('next-btn');
        this.restartBtn = document.getElementById('restart-btn');
        
        this.questionText = document.getElementById('question-text');
        this.answersContainer = document.getElementById('answers-container');
        this.feedback = document.getElementById('feedback');
        this.questionCounter = document.getElementById('question-counter');
        this.progressFill = document.getElementById('progress-fill');
        this.currentScoreEl = document.getElementById('current-score');
        
        this.finalScoreEl = document.getElementById('final-score');
        this.correctAnswersEl = document.getElementById('correct-answers');
        this.wrongAnswersEl = document.getElementById('wrong-answers');
        this.percentageEl = document.getElementById('percentage');
        this.resultMessage = document.getElementById('result-message');
        this.resultDescription = document.getElementById('result-description');
        
        this.initEventListeners();
    }
    
    initEventListeners() {
        this.startBtn.addEventListener('click', () => this.startQuiz());
        this.nextBtn.addEventListener('click', () => this.nextQuestion());
        this.restartBtn.addEventListener('click', () => this.restartQuiz());
    }
    
    startQuiz() {
        this.currentQuestion = 0;
        this.score = 0;
        this.wrongAnswers = 0;
        this.showScreen('quiz');
        this.loadQuestion();
    }
    
    showScreen(screen) {
        this.welcomeScreen.classList.remove('active');
        this.quizScreen.classList.remove('active');
        this.resultsScreen.classList.remove('active');
        
        switch(screen) {
            case 'welcome':
                this.welcomeScreen.classList.add('active');
                break;
            case 'quiz':
                this.quizScreen.classList.add('active');
                break;
            case 'results':
                this.resultsScreen.classList.add('active');
                break;
        }
    }
    
    loadQuestion() {
        this.isAnswered = false;
        this.nextBtn.style.display = 'none';
        this.feedback.classList.remove('show', 'correct', 'wrong');
        
        const question = quizData[this.currentQuestion];
        
        // Update question text
        this.questionText.textContent = question.question;
        
        // Update progress
        const progress = ((this.currentQuestion + 1) / quizData.length) * 100;
        this.progressFill.style.width = progress + '%';
        this.questionCounter.textContent = `Frage ${this.currentQuestion + 1} von ${quizData.length}`;
        
        // Update score display
        this.currentScoreEl.textContent = this.score;
        
        // Load answers
        this.answersContainer.innerHTML = '';
        question.answers.forEach((answer, index) => {
            const button = document.createElement('button');
            button.className = 'answer-btn';
            button.textContent = answer;
            button.addEventListener('click', () => this.selectAnswer(index));
            this.answersContainer.appendChild(button);
        });
    }
    
    selectAnswer(selectedIndex) {
        if (this.isAnswered) return;
        
        this.isAnswered = true;
        const question = quizData[this.currentQuestion];
        const answerButtons = this.answersContainer.querySelectorAll('.answer-btn');
        
        // Disable all buttons
        answerButtons.forEach(btn => btn.disabled = true);
        
        // Check if answer is correct
        const isCorrect = selectedIndex === question.correct;
        
        if (isCorrect) {
            this.score++;
            answerButtons[selectedIndex].classList.add('correct');
            this.showFeedback(true, question.explanation);
        } else {
            this.wrongAnswers++;
            answerButtons[selectedIndex].classList.add('wrong');
            answerButtons[question.correct].classList.add('correct');
            this.showFeedback(false, question.explanation);
        }
        
        // Update score
        this.currentScoreEl.textContent = this.score;
        
        // Show next button
        this.nextBtn.style.display = 'block';
    }
    
    showFeedback(isCorrect, explanation) {
        this.feedback.classList.add('show');
        this.feedback.classList.add(isCorrect ? 'correct' : 'wrong');
        
        const icon = isCorrect ? '‚úÖ' : '‚ùå';
        const title = isCorrect ? '<strong>Richtig!</strong>' : '<strong>Falsch!</strong>';
        
        this.feedback.innerHTML = `
            <div style="display: flex; align-items: start; gap: 10px;">
                <span style="font-size: 1.5rem;">${icon}</span>
                <div>
                    ${title}
                    <p style="margin-top: 8px;">${explanation}</p>
                </div>
            </div>
        `;
    }
    
    nextQuestion() {
        this.currentQuestion++;
        
        if (this.currentQuestion < quizData.length) {
            this.loadQuestion();
        } else {
            this.showResults();
        }
    }
    
    showResults() {
        this.showScreen('results');
        
        const percentage = Math.round((this.score / quizData.length) * 100);
        
        // Update statistics
        this.finalScoreEl.textContent = this.score;
        this.correctAnswersEl.textContent = this.score;
        this.wrongAnswersEl.textContent = this.wrongAnswers;
        this.percentageEl.textContent = percentage + '%';
        
        // Determine result message based on score
        let message, description;
        
        if (percentage >= 90) {
            message = "üåü Hervorragend!";
            description = "Du bist ein echter Experte f√ºr amerikanische und britische High Schools! Dein Wissen ist ausgezeichnet!";
        } else if (percentage >= 75) {
            message = "üéØ Sehr gut!";
            description = "Du hast ein sehr gutes Verst√§ndnis f√ºr die Unterschiede zwischen amerikanischen und britischen High Schools!";
        } else if (percentage >= 60) {
            message = "üëç Gut gemacht!";
            description = "Du kennst dich schon recht gut aus. Mit etwas mehr √úbung wirst du zum Experten!";
        } else if (percentage >= 40) {
            message = "üìö Nicht schlecht!";
            description = "Du hast einige richtige Antworten gegeben. Lies dir die Erkl√§rungen durch und versuche es nochmal!";
        } else {
            message = "üí™ Weiter √ºben!";
            description = "Die Unterschiede zwischen den Schulsystemen sind nicht einfach. Versuche es nochmal und lies die Erkl√§rungen aufmerksam!";
        }
        
        this.resultMessage.textContent = message;
        this.resultDescription.textContent = description;
    }
    
    restartQuiz() {
        this.showScreen('welcome');
    }
}

// Initialize quiz when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    const quiz = new QuizApp();
});
